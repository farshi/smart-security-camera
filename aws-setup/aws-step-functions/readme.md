
# aws-step-functions

This directory contains the AWS step function definition used by the smart-security-camera project. The step function orchestrates calls to the [AWS Lambda Functions](https://github.com/markwest1972/smart-security-camera/tree/master/aws-lambda-functions).

At the time of writing it is **not possible to edit a step function once it is created**.  Therefore you should always keep a backup copy of any changes.

## Contents

* **step-function-image-processing.json** - Process definition for step function.
* **step-function-image-processing.jpg** - visual representation of step function generated by AWS.

## How to use

### IAM Role 

Normally AWS will generate a role for you, but if it doesn't then you can use the [AWS IAM Console](https://aws.amazon.com/console/) create an IAM Role containing the "AWSLambdaRole" permission. This will allow your state machine to call AWS Lambda Functions.

### Setting up the Step Function (aka State Machine)

This is done from the [Step Function Console](https://aws.amazon.com/step-functions/).  Note that Amazon uses 'State Machine' and 'Step Function' interchangebly.

Creating the step function is trivial - you basically copy the contents of the JSON file into the wizard.  The following tips might save your some time:

1. Define your [AWS Lambda Functions](https://github.com/markwest1972/smart-security-camera/tree/master/aws-lambda-functions) before starting with the step function.
2. Use the name *step-function-image-processing* - if you change it you'll have to also change the s3-trigger-image-processing function.
3. Make sure the correct arn values are used in the Resource values.  The arn value for each Lambda Function is visible in the top right hand corner of the screen when viewing a Lambda Function definition.
